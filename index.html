<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Boss AI Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet"/>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Orbitron', sans-serif; background: linear-gradient(to right, #000,#0a0a2a); color: #00bfff; display: flex; height: 100vh; overflow: hidden; }
    .glow { text-shadow: 0 0 5px #00bfff, 0 0 10px #00bfff; }
    .sidebar { width:250px; background:#0d0d0d; padding:60px 10px 20px; display:flex; flex-direction:column; gap:10px; height:100vh; position:fixed; left:0; top:0; border-right:2px solid #1a1a1a; z-index:100; transition:transform .3s; }
    .sidebar.hidden { transform:translateX(-100%); }
    .sidebar button { background:#121212; color:#00bfff; border:none; padding:12px; font-size:14px; text-align:left; border-radius:6px; cursor:pointer; }
    .sidebar button.active { background:#007bff; color:white; }
    .main { flex-grow:1; margin-left:250px; width:calc(100% - 250px); display:flex; flex-direction:column; padding:20px; overflow-y:auto; }
    .main.full { margin-left:0; width:100%; }
    #toggle-btn { position:fixed; top:10px; left:10px; background:#007bff; color:white; padding:10px 16px; border:none; border-radius:6px; cursor:pointer; z-index:1000; }
    textarea, input { width:100%; max-width:600px; padding:12px; margin-top:10px; border:1px solid #00bfff; background:#1a1a1a; color:white; border-radius:6px; font-size:15px; }
    button.generate-btn { background:#007bff; color:white; border:none; border-radius:6px; padding:10px 16px; margin-top:10px; cursor:pointer; font-size:15px; }
    #manager-response { max-height:300px; overflow-y:auto; padding:10px; background:#121212; border:1px solid #00bfff; margin-top:10px; white-space:pre-wrap; }
    #automation-canvas { position:relative; border:2px solid #00bfff; background:#1a1a1a; width:100%; height:500px; margin-top:20px; overflow:hidden; }
    .node { position:absolute; background:#121212; border:1px solid #00bfff; padding:6px 10px; border-radius:6px; color:#00bfff; cursor:move; user-select:none; }
    svg.connector { position:absolute; width:100%; height:100%; top:0; left:0; pointer-events:none; }
  </style>
</head>
<body>
  <button id="toggle-btn">‚ò∞ Menu</button>
  <div class="sidebar" id="sidebar">
    <button data-module="manager" class="active">ü§ñ Manager AI</button>
    <button data-module="script">‚úçÔ∏è Script Writer</button>
    <button data-module="voiceover">üé§ Voiceover</button>
    <button data-module="automation">‚öôÔ∏è Automation AI</button>
    <button data-module="upload">üì§ Upload Strategy</button>
    <button data-module="trends">üìà Trends AI</button>
    <button data-module="legal">‚öñÔ∏è Legal Review</button>
    <button data-module="output">üì¶ Final Output</button>
    <button data-module="history">üïì History</button>
    <button data-module="sheets">üßæ Sheets Log</button>
    <button data-module="settings">‚öôÔ∏è Settings</button>
  </div>
  <div class="main" id="main">
    <h1 class="glow">Boss AI Dashboard</h1>
    <p class="glow">Welcome. Select a module or frame a Manager AI command.</p>
  </div>

  <script>
    const MODELS = {
      manager: `
        <h2 class="glow">ü§ñ Manager AI</h2>
        <textarea id="manager-command" placeholder="E.g. generate a script on X then voiceover."></textarea><br>
        <button class="generate-btn" onclick="runManager()">Submit</button>
        <div id="manager-response" class="glow"></div>
      `,
      script: `
        <h2 class="glow">‚úçÔ∏è Script Writer</h2>
        <textarea id="script-input" placeholder="Describe topic..."></textarea><br>
        <div id="script-key-box"></div>
        <button class="generate-btn" onclick="generateScript()">Generate Script</button>
        <p id="script-output"></p>
      `,
      voiceover: `
        <h2 class="glow">üé§ Voiceover</h2>
        <textarea id="voice-text" placeholder="Paste script..."></textarea><br>
        <div id="voice-key-box"></div>
        <button class="generate-btn" onclick="generateVoice()">Generate Voice</button>
        <p id="voice-status"></p>
      `,
      automation: `
        <h2 class="glow">‚öôÔ∏è Automation AI</h2>
        <button class="generate-btn" onclick="addNode('Script Writer')">+ Script Node</button>
        <button class="generate-btn" onclick="addNode('Voiceover')">+ Voice Node</button>
        <button class="generate-btn" onclick="clearNodes()">Reset</button>
        <div id="automation-canvas"><svg class="connector"></svg></div>
      `,
      upload: `<h2 class="glow">üì§ Upload Strategy</h2><p>(Coming soon)</p>`,
      trends: `<h2 class="glow">üìà Trends AI</h2><p>(Coming soon)</p>`,
      legal: `<h2 class="glow">‚öñÔ∏è Legal Review</h2><p>(Coming soon)</p>`,
      output: `<h2 class="glow">üì¶ Final Output</h2><p>(Coming soon)</p>`,
      history: `<h2 class="glow">üïì History</h2><p>(Coming soon)</p>`,
      sheets: `<h2 class="glow">üßæ Sheets Log</h2><p>(Coming soon)</p>`,
      settings: `
        <h2 class="glow">‚öôÔ∏è Settings</h2>
        <button class="generate-btn" onclick="localStorage.clear(); location.reload()">Clear API Keys</button>
      `
    };

    const sidebar = document.getElementById('sidebar'), main = document.getElementById('main');

    sidebar.querySelectorAll('button').forEach(btn=>{
      btn.addEventListener('click',()=>{
        sidebar.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        main.innerHTML = `<div style="max-width:800px; width:100%;">${MODELS[btn.dataset.module]}</div>`;
        if(btn.dataset.module==='script') loadScriptKey();
        if(btn.dataset.module==='voiceover') loadVoiceKey();
        if(btn.dataset.module==='automation') initAutomation();
      });
    });

    document.getElementById('toggle-btn').onclick = ()=>{
      sidebar.classList.toggle('hidden');
      main.classList.toggle('full');
    };

    function loadScriptKey(){
      const k=localStorage.getItem('openrouter_key'), box=document.getElementById('script-key-box');
      box.innerHTML = k
        ? `<p class="glow">‚úÖ OpenRouter key saved.<button onclick="clearScriptKey()">Change</button></p>`
        : `<input id="script-key" placeholder="OpenRouter API key"><button onclick="saveScriptKey()">Save</button>`;
    }
    function saveScriptKey(){let v=document.getElementById('script-key').value.trim(); if(v.length>10){localStorage.setItem('openrouter_key',v);location.reload()}}
    function clearScriptKey(){localStorage.removeItem('openrouter_key');location.reload()}

    function loadVoiceKey(){
      const k=localStorage.getItem('elevenlabs_key'), box=document.getElementById('voice-key-box');
      box.innerHTML = k
        ? `<p class="glow">‚úÖ ElevenLabs key saved.</p>`
        : `<input id="voice-key" placeholder="ElevenLabs API key"><button onclick="saveVoiceKey()">Save</button>`;
    }
    function saveVoiceKey(){let v=document.getElementById('voice-key').value.trim(); if(v.length>10){localStorage.setItem('elevenlabs_key',v);location.reload()}}

    async function generateScript(){
      const key=localStorage.getItem('openrouter_key'), prompt=document.getElementById('script-input').value.trim(), out=document.getElementById('script-output');
      if(!key||!prompt){out.innerText='‚ùå Missing';return;}
      out.innerText='üß† Generating...';
      const r=await fetch('https://openrouter.ai/api/v1/chat/completions',{
        method:'POST',
        headers:{'Authorization':'Bearer '+key,'Content-Type':'application/json'},
        body:JSON.stringify({model:'openai/gpt-3.5-turbo',messages:[{role:'system',content:'You are a script writer for short videos.'},{role:'user',content:prompt}]})
      });
      const d=await r.json();
      out.innerText=d.choices?.[0]?.message?.content||'‚ùå Error';
    }

    async function generateVoice(){
      const key=localStorage.getItem('elevenlabs_key'), txt=document.getElementById('voice-text').value.trim(), status=document.getElementById('voice-status');
      if(!key||!txt){status.innerText='‚ùå Missing';return;}
      status.innerText='üéô Generating...';
      const r=await fetch('https://api.elevenlabs.io/v1/text-to-speech/pNInz6obpgDQGcFmaJgB',{
        method:'POST',
        headers:{'xi-api-key':key,'Content-Type':'application/json'},
        body:JSON.stringify({model_id:'eleven_monolingual_v1',voice_settings:{stability:0.5,similarity_boost:0.5},text:txt})
      });
      const blob=await r.blob(), audio=new Audio(URL.createObjectURL(blob));
      audio.play(); status.innerText='‚úÖ Playing';
    }

    async function runManager(){
      const key=localStorage.getItem('openrouter_key'), cmd=document.getElementById('manager-command').value.trim(), box=document.getElementById('manager-response');
      if(!key||!cmd){box.innerText='‚ùå Missing';return;}
      box.innerText='ü§ñ Thinking...';
      const res=await fetch('https://openrouter.ai/api/v1/chat/completions',{
        method:'POST',
        headers:{'Authorization':'Bearer '+key,'Content-Type':'application/json'},
        body:JSON.stringify({
          model:'openai/gpt-4',
          messages:[
            {role:'system',content: `You are Manager AI. 
You know all dashboard modules: Script, Voiceover, Automation, Upload, Trends, Legal, Output, History, Settings.
You execute logical commands, produce JS snippets inside \`\`\`js blocks\`\`\` to run UI updates.
You avoid hallucination; reference only internal state. Persist a \'memory\' log in localStorage under \'manager_history\'. When asked "what functions does this app have?", list them accurately.`},
            {role:'user',content:cmd}
          ]
        })
      });
      const d=await res.json(), msg=d.choices?.[0]?.message?.content||'‚ùå No response';
      box.innerHTML=msg;
      const hist=JSON.parse(localStorage.getItem('manager_history')||'[]'); hist.push({cmd,reply:msg,ts:Date.now()});
      localStorage.setItem('manager_history',JSON.stringify(hist));
      const m=msg.match(/```js\s*([\s\S]+?)```/);
      if(m){ try{ eval(m[1]) }catch(e){ box.innerHTML+=`<br><span style="color:red;">‚ö†Ô∏è JS Error: ${e.message}</span>`} }
    }

    let canvas, nodes=[], nodeCount=0;
    function initAutomation(){ canvas=document.getElementById('automation-canvas'); canvas.innerHTML='<svg class="connector"></svg>'; nodes=[]; nodeCount=0 }
    function addNode(label){
      const d=document.createElement('div');
      d.className='node'; d.textContent=label; d.dataset.id=++nodeCount;
      d.style.left=`${30+nodeCount*60}px`; d.style.top=`${30+nodeCount*30}px`;
      makeDraggable(d); canvas.appendChild(d); nodes.push(d); drawConnections();
    }
    function makeDraggable(el){
      let ox=0,oy=0,drag=false;
      el.onmousedown=e=>{drag=true;ox=e.clientX-el.offsetLeft;oy=e.clientY-el.offsetTop;document.onmousemove=onMove;document.onmouseup=onUp;}
      function onMove(e){ if(!drag)return; el.style.left=e.clientX-ox+'px'; el.style.top=e.clientY-oy+'px'; drawConnections() }
      function onUp(){ drag=false; document.onmousemove=null; document.onmouseup=null; }
    }
    function drawConnections(){
      const svg=canvas.querySelector('svg'); svg.innerHTML='';
      for(let i=0;i<nodes.length-1;i++){
        const a=nodes[i].getBoundingClientRect(), b=nodes[i+1].getBoundingClientRect();
        const X1=a.left+a.width/2-canvas.getBoundingClientRect().left, Y1=a.top+a.height/2-canvas.getBoundingClientRect().top;
        const X2=b.left+b.width/2-canvas.getBoundingClientRect().left, Y2=b.top+b.height/2-canvas.getBoundingClientRect().top;
        const l=document.createElementNS('http://www.w3.org/2000/svg','line');
        l.setAttribute('x1',X1); l.setAttribute('y1',Y1); l.setAttribute('x2',X2); l.setAttribute('y2',Y2);
        l.setAttribute('stroke','#00bfff'); l.setAttribute('stroke-width','2'); svg.appendChild(l);
      }
    }
    function clearNodes(){ initAutomation() }

    window.onload = ()=>sidebar.querySelector('[data-module="manager"]').click();
  </script>
</body>
</html>
