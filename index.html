<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Boss AI Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet"/>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(to right, #000000, #0a0a2a);
      color: #00bfff;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    .glow { text-shadow: 0 0 5px #00bfff, 0 0 10px #00bfff; }
    .sidebar {
      width: 240px;
      background: #0d0d0d;
      padding: 60px 10px 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      border-right: 2px solid #1a1a1a;
      z-index: 100;
      transition: transform 0.3s ease;
    }
    .sidebar.hidden { transform: translateX(-100%); }
    .sidebar button {
      background: #121212;
      color: #00bfff;
      border: none;
      padding: 12px;
      font-size: 14px;
      text-align: left;
      border-radius: 6px;
      cursor: pointer;
    }
    .sidebar button.active {
      background-color: #007bff;
      color: white;
    }
    .main {
      flex-grow: 1;
      margin-left: 240px;
      width: calc(100% - 240px);
      display: flex;
      flex-direction: column;
      padding: 20px;
      overflow-y: auto;
    }
    .main.full {
      margin-left: 0;
      width: 100%;
    }
    #toggle-btn {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background-color: #007bff;
      color: white;
      padding: 10px 16px;
      border-radius: 6px;
      font-size: 16px;
      border: none;
      cursor: pointer;
    }
    textarea, input {
      width: 100%;
      max-width: 500px;
      padding: 12px;
      margin-top: 10px;
      font-size: 15px;
      border-radius: 6px;
      border: 1px solid #00bfff;
      background-color: #1a1a1a;
      color: white;
    }
    button.generate-btn {
      background-color: #007bff;
      color: white;
      border: none;
      margin: 10px 0;
      padding: 10px 16px;
      border-radius: 6px;
      font-size: 15px;
      cursor: pointer;
    }
    #manager-response {
      max-height: 300px;
      overflow-y: auto;
      padding: 10px;
      border: 1px solid #00bfff;
      margin-top: 10px;
      background-color: #121212;
      white-space: pre-wrap;
      width: 100%;
      font-size: 14px;
    }
    .error-text { color: red; font-weight: bold; }
    #automation-canvas {
      position: relative;
      border: 2px solid #00bfff;
      background: #1a1a1a;
      width: 100%;
      height: 500px;
      margin-top: 20px;
    }
    .node {
      position: absolute;
      background: #121212;
      border: 1px solid #00bfff;
      padding: 6px 10px;
      color: #00bfff;
      border-radius: 6px;
      cursor: grab;
    }
  </style>
</head>
<body>
  <button id="toggle-btn">‚ò∞ Menu</button>
  <div class="sidebar" id="sidebar">
    <button data-module="manager" class="active">ü§ñ Manager AI</button>
    <button data-module="script">‚úçÔ∏è Script Writer</button>
    <button data-module="voiceover">üé§ Voiceover</button>
    <button data-module="automation">‚öôÔ∏è Automation AI</button>
  </div>
  <div class="main" id="main">
    <h1 class="glow">Boss AI Dashboard</h1>
    <p class="glow">Welcome. Select a module.</p>
  </div>

  <script>
    const toggleBtn = document.getElementById("toggle-btn"),
          sidebar = document.getElementById("sidebar"),
          main = document.getElementById("main");

    toggleBtn.addEventListener("click", () => {
      sidebar.classList.toggle("hidden");
      main.classList.toggle("full");
    });

    const content = {
      manager: `
        <h2 class="glow">ü§ñ Manager AI</h2>
        <textarea id="manager-command" placeholder="E.g. Change title to 'Upload Ready'"></textarea>
        <button class="generate-btn" onclick="runManagerCommand()">Send</button>
        <button class="generate-btn" onclick="clearManagerChat()">Clear Chat</button>
        <div id="manager-response" class="glow"></div>
      `,
      script: `
        <h2 class="glow">‚úçÔ∏è Script Writer</h2>
        <textarea id="script-input" placeholder="Your video topic..."></textarea>
        <div id="script-key-box"></div>
        <button class="generate-btn" onclick="generateScript()">Generate Script</button>
        <p id="script-output"></p>
      `,
      voiceover: `
        <h2 class="glow">üé§ Voiceover</h2>
        <textarea id="voice-text" placeholder="Enter your script here..."></textarea>
        <div id="voice-key-box"></div>
        <button class="generate-btn" onclick="generateVoice()">Generate Voice</button>
        <p id="voice-status"></p>
      `,
      automation: `
        <h2 class="glow">‚öôÔ∏è Automation AI (n8n style)</h2>
        <button class="generate-btn" onclick="addNode()">+ Add Node</button>
        <button class="generate-btn" onclick="exportWorkflow()">Export Workflow</button>
        <button class="generate-btn" onclick="importWorkflow()">Import Workflow</button>
        <div id="automation-canvas"></div>
      `
    };

    function loadModule(mod) {
      document.querySelectorAll(".sidebar button").forEach(b => b.classList.remove("active"));
      document.querySelector(`[data-module="${mod}"]`).classList.add("active");
      main.innerHTML = `<div style="max-width:800px;width:100%;">${content[mod]}</div>`;
      localStorage.setItem("last_module", mod);
      if (mod==='script') loadScriptKey();
      if (mod==='voiceover') loadVoiceKey();
      if (mod==='automation') initAutomation();
    }

    document.querySelectorAll('.sidebar button').forEach(b=>b.addEventListener('click', ()=>loadModule(b.getAttribute('data-module'))));
    window.onload = ()=>loadModule(localStorage.getItem('last_module')||'manager');

    function clearManagerChat(){
      localStorage.removeItem("manager_conversation");
      document.getElementById("manager-response").innerHTML="üßπ Chat cleared.";
    }

    /* Script & Voice */
    function loadScriptKey(){
      const box=document.getElementById("script-key-box"),
            key=localStorage.getItem("openrouter_key");
      box.innerHTML = key
        ? `<p class="glow">‚úÖ Key saved. <button onclick="clearScriptKey()">Change</button></p>`
        : `<input id="script-key" type="password" placeholder="üîë OpenRouter API Key"/><button onclick="saveScriptKey()">Save</button>`;
    }
    function saveScriptKey(){
      let v=document.getElementById("script-key").value.trim();
      if(v.length>10){localStorage.setItem("openrouter_key",v);loadModule('script');}
    }
    function clearScriptKey(){localStorage.removeItem("openrouter_key");loadModule('script');}
    async function generateScript(){
      let key=localStorage.getItem("openrouter_key"),inp=document.getElementById("script-input").value.trim(),out=document.getElementById("script-output");
      if(!key||!inp)return out.innerHTML="‚ùå Missing input or key";
      out.innerHTML="üß† Writing...";
      try{
        let res=await fetch("https://openrouter.ai/api/v1/chat/completions",{
          method:"POST",headers:{"Authorization":"Bearer "+key,"Content-Type":"application/json"},
          body:JSON.stringify({model:"openai/gpt-3.5-turbo",messages:[{role:"system",content:"..."},{role:"user",content:inp}]})
        });
        let j=await res.json();
        out.innerHTML=j.choices?.[0]?.message?.content||"<span class='error-text'>‚ùåError</span>";
      }catch(e){out.innerHTML=`<span class='error-text'>‚ùå ${e.message}</span>`;}
    }

    function loadVoiceKey(){
      const box=document.getElementById("voice-key-box"),key=localStorage.getItem("elevenlabs_key");
      box.innerHTML = key
        ? `<p class="glow">‚úÖ Key saved. <button onclick="clearVoiceKey()">Change</button></p>`
        : `<input id="voice-key" type="password" placeholder="üîë ElevenLabs Key"/><button onclick="saveVoiceKey()">Save</button>`;
    }
    function saveVoiceKey(){
      let v=document.getElementById("voice-key").value.trim();
      if(v.length>10){localStorage.setItem("elevenlabs_key",v);loadModule('voiceover');}
    }
    function clearVoiceKey(){localStorage.removeItem("elevenlabs_key");loadModule('voiceover');}
    async function generateVoice(){
      let key=localStorage.getItem("elevenlabs_key"),txt=document.getElementById("voice-text").value.trim(),st=document.getElementById("voice-status");
      if(!key||!txt)return st.innerHTML="‚ùå Missing input or key";
      st.innerHTML="üéô Generating...";
      try{
        let res=await fetch("https://api.elevenlabs.io/v1/text-to-speech/pNInz6obpgDQGcFmaJgB",{
          method:"POST",headers:{"xi-api-key":key,"Content-Type":"application/json"},
          body:JSON.stringify({model_id:"eleven_monolingual_v1",voice_settings:{stability:0.5,similarity_boost:0.5},text:txt})
        });
        let blob=await res.blob();
        let url=URL.createObjectURL(blob);
        new Audio(url).play();
        st.innerHTML="‚úÖ Playing voice";
      }catch(e){st.innerHTML=`<span class='error-text'>‚ùå ${e.message}</span>`;}
    }

    /* Manager AI with context & automation trigger */
    async function runManagerCommand(){
      let key=localStorage.getItem("openrouter_key"),cmd=document.getElementById("manager-command").value.trim(),box=document.getElementById("manager-response");
      if(!key||!cmd)return box.innerHTML="‚ùåMissing input or key";box.innerHTML="ü§ñThinking...";
      let history=JSON.parse(localStorage.getItem("manager_conversation")||"[]");
      history.push({role:"user",content:cmd});
      let limited=history.slice(-6);
      try{
        let res=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Authorization":"Bearer "+key,"Content-Type":"application/json"},body:JSON.stringify({model:"openai/gpt-3.5-turbo",messages:[{role:"system",content:"You are Manager AI. Output JS using triggerAutomation('...') to add automation nodes."},...limited]})});
        let j=await res.json(),reply=j.choices?.[0]?.message?.content||"‚ùå No response";
        box.innerHTML=reply;
        localStorage.setItem("manager_conversation",JSON.stringify([...limited,{role:"assistant",content:reply}]));
        scrollBottom(box);

        let js=reply.match(/```js\s*([\s\S]+?)```/);
        if(js){try{eval(js[1]);box.innerHTML+="\n\n‚úÖ Executed JS"}catch(e){box.innerHTML+=`\n\n‚ö†Ô∏èJS Error:${e.message}`}}
      }catch(e){box.innerHTML=`<span class='error-text'>‚ùåFailed:${e.message}</span>`;}
    }
    function scrollBottom(el){setTimeout(()=>el.scrollTop=el.scrollHeight,50)}

    /* Automation-n8n style */
    let canvas, nodes=[], nodeId=1;
    function initAutomation(){
      canvas = document.getElementById("automation-canvas");
      canvas.innerHTML="";
      nodes=[];
    }

    function addNode(){
      const div=document.createElement("div");
      div.className="node";
      div.textContent="Node "+nodeId;
      div.dataset.id=nodeId++;
      div.style.top="20px";div.style.left="20px";
      makeDraggable(div);
      canvas.appendChild(div);
      nodes.push({id:div.dataset.id,x:20,y:20,label:div.textContent});
    }
    function makeDraggable(el){
      let ox,oy;
      el.addEventListener("mousedown", e=>{
        ox=e.offsetX;oy=e.offsetY;
        function move(ev){
          el.style.left=(ev.clientX-ox-(sidebar.classList.contains("hidden")?0: sidebar.offsetWidth))+"px";
          el.style.top=(ev.clientY-oy-10)+"px";
        }
        function up(){document.removeEventListener("mousemove",move);document.removeEventListener("mouseup",up);}
        document.addEventListener("mousemove",move);
        document.addEventListener("mouseup",up);
      });
    }
    function exportWorkflow(){
      const w=nodes.map(n=>({id:n.id,x:document.querySelector(`.node[data-id="${n.id}"]`).offsetLeft,y:document.querySelector(`.node[data-id="${n.id}"]`).offsetTop,label:document.querySelector(`.node[data-id="${n.id}"]`).textContent}));
      prompt("Workflow JSON:",JSON.stringify(w,null,2));
    }
    function importWorkflow(){
      let txt=prompt("Paste workflow JSON:");
      if(!txt)return;
      try{
        let arr=JSON.parse(txt);
        initAutomation();
        arr.forEach(n=>{
          const div=document.createElement("div");
          div.className="node";
          div.dataset.id=n.id;
          div.textContent=n.label;
          div.style.left=n.x+"px";div.style.top=n.y+"px";
          makeDraggable(div);
          canvas.appendChild(div);
          nodes.push(n);
        });
      }catch(e){alert("Invalid JSON");}
    }
  </script>
</body>
</html>
