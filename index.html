<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Boss AI Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet"/>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(to right, #000000, #0a0a2a);
      color: #00bfff;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    .glow { text-shadow: 0 0 5px #00bfff, 0 0 10px #00bfff; }
    .sidebar {
      width: 240px;
      background: #0d0d0d;
      padding: 60px 10px 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      height: 100vh;
      position: fixed;
      left: 0; top: 0;
      border-right: 2px solid #1a1a1a;
      z-index: 100;
      transition: transform 0.3s ease;
    }
    .sidebar.hidden { transform: translateX(-100%); }
    .sidebar button {
      background: #121212;
      color: #00bfff;
      border: none;
      padding: 12px;
      font-size: 14px;
      text-align: left;
      border-radius: 6px;
      cursor: pointer;
    }
    .sidebar button.active {
      background-color: #007bff;
      color: white;
    }
    .main {
      flex-grow: 1;
      margin-left: 240px;
      width: calc(100% - 240px);
      display: flex; flex-direction: column;
      padding: 20px;
      overflow-y: auto;
    }
    .main.full { margin-left: 0; width: 100%; }
    #toggle-btn {
      position: fixed; top: 10px; left: 10px;
      z-index: 1000;
      background-color: #007bff;
      color: white;
      padding: 10px 16px;
      border-radius: 6px;
      font-size: 16px; border: none; cursor: pointer;
    }
    textarea, input {
      width: 100%; max-width: 500px;
      padding: 12px; margin-top: 10px;
      font-size: 15px; border-radius: 6px;
      border: 1px solid #00bfff;
      background-color: #1a1a1a; color: white;
    }
    button.generate-btn {
      background-color: #007bff;
      color: white;
      border: none;
      margin-top: 10px;
      padding: 10px 16px;
      border-radius: 6px;
      font-size: 15px;
      cursor: pointer;
    }
    .glow-box {
      max-width: 800px;
      padding: 10px;
      background: #121212;
      border: 1px solid #00bfff;
      margin-top: 10px;
      white-space: pre-wrap;
    }
    #automation-canvas {
      position: relative;
      border: 2px solid #00bfff;
      background: #1a1a1a;
      width: 100%;
      height: 500px;
      margin-top: 20px;
      overflow: hidden;
    }
    .node {
      position: absolute;
      background: #121212;
      border: 1px solid #00bfff;
      padding: 6px 10px;
      color: #00bfff;
      border-radius: 6px;
      cursor: move;
      user-select: none;
    }
    svg.connector {
      position: absolute; top: 0; left: 0;
      pointer-events: none; width: 100%; height: 100%;
    }
  </style>
</head>
<body>
  <button id="toggle-btn">‚ò∞ Menu</button>
  <div class="sidebar" id="sidebar">
    <button data-module="manager" class="active">ü§ñ Manager AI</button>
    <button data-module="script">‚úçÔ∏è Script Writer</button>
    <button data-module="voiceover">üé§ Voiceover</button>
    <button data-module="automation">‚öôÔ∏è Automation AI</button>
    <button data-module="upload">üì§ Upload Strategy</button>
    <button data-module="trends">üìà Trends</button>
    <button data-module="legal">üìë Legal Review</button>
    <button data-module="output">üì¶ Final Output</button>
    <button data-module="history">üóÇÔ∏è History</button>
    <button data-module="settings">‚öôÔ∏è Settings</button>
  </div>
  <div class="main" id="main">
    <h1 class="glow">Boss AI Dashboard</h1>
    <p class="glow">Welcome. Use Manager AI to start an automated content flow.</p>
  </div>

  <script>
    const toggleBtn = document.getElementById("toggle-btn"),
          sidebar = document.getElementById("sidebar"),
          main = document.getElementById("main");

    const content = {
      manager: `
        <h2 class="glow">ü§ñ Manager AI</h2>
        <textarea id="manager-command" placeholder="e.g., Generate script on cats then voiceover"></textarea><br>
        <button class="generate-btn" onclick="runManagerCommand()">Send</button>
        <div id="manager-response" class="glow-box"></div>
      `,
      script: `
        <h2 class="glow">‚úçÔ∏è Script Writer</h2>
        <textarea id="script-input" placeholder="Topic for script..."></textarea><br>
        <div id="script-key-box"></div>
        <button class="generate-btn" onclick="generateScript()">Generate Script</button>
        <p id="script-output" class="glow-box"></p>
      `,
      voiceover: `
        <h2 class="glow">üé§ Voiceover</h2>
        <textarea id="voice-text" placeholder="Script text for voice..."></textarea><br>
        <div id="voice-key-box"></div>
        <button class="generate-btn" onclick="generateVoice()">Generate Voice</button>
        <audio id="voice-player" controls style="margin-top:10px;"></audio>
      `,
      automation: `
        <h2 class="glow">‚öôÔ∏è Automation AI</h2>
        <button class="generate-btn" onclick="addNode('Script Writer')">+ Script Node</button>
        <button class="generate-btn" onclick="addNode('Voiceover')">+ Voice Node</button>
        <button class="generate-btn" onclick="clearNodes()">Reset</button>
        <div id="automation-canvas"><svg class="connector"></svg></div>
      `,
      upload: `
        <h2 class="glow">üì§ Upload Strategy</h2>
        <textarea id="upload-input" placeholder="Describe video for strategy..."></textarea><br>
        <button class="generate-btn" onclick="generateUploadStrategy()">Generate Strategy</button>
        <div id="upload-output" class="glow-box"></div>
      `,
      trends: `
        <h2 class="glow">üìà Trends & Topic AI</h2>
        <textarea id="trends-input" placeholder="Your niche/topic..."></textarea><br>
        <button class="generate-btn" onclick="generateTrends()">Get Trends</button>
        <div id="trends-output" class="glow-box"></div>
      `,
      legal: `
        <h2 class="glow">üìë Legal Review</h2>
        <textarea id="legal-input" placeholder="Script or plan..."></textarea><br>
        <button class="generate-btn" onclick="generateLegalReview()">Review</button>
        <div id="legal-output" class="glow-box"></div>
      `,
      output: `
        <h2 class="glow">üì¶ Final Output</h2>
        <div id="final-output-box" class="glow-box">Outputs appear here after workflow runs.</div>
      `,
      history: `
        <h2 class="glow">üóÇÔ∏è History Log</h2>
        <div id="history-log" class="glow-box">History will show here.</div>
      `,
      settings: `
        <h2 class="glow">‚öôÔ∏è Settings</h2>
        <button class="generate-btn" onclick="clearAllKeys()">Clear All Keys</button><br>
        <button class="generate-btn" onclick="testKeys()">Test Keys</button>
        <div id="settings-output" class="glow-box"></div>
      `
    };

    let historyLog = [];
    let canvas, nodes = [], nodeCount = 0;

    document.querySelectorAll(".sidebar button").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".sidebar button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const mod = btn.getAttribute("data-module");
        main.innerHTML = `<div style="max-width:800px;width:100%;">${content[mod]}</div>`;
        if (mod === "script") loadScriptKey();
        if (mod === "voiceover") loadVoiceKey();
        if (mod === "automation") initAutomation();
      });
    });

    toggleBtn.addEventListener("click", () => {
      sidebar.classList.toggle("hidden");
      main.classList.toggle("full");
    });

    // ‚Äî Key functions
    function loadScriptKey() {
      const k = localStorage.getItem("openrouter_key");
      const bx = document.getElementById("script-key-box");
      bx.innerHTML = k
        ? `<p class="glow">‚úÖ Key saved. <button class="generate-btn" onclick="clearScriptKey()">Change</button></p>`
        : `<input id="script-key" type="password" placeholder="üîë OpenRouter Key"/><button class="generate-btn" onclick="saveScriptKey()">Save</button>`;
    }
    function loadVoiceKey() {
      const k = localStorage.getItem("elevenlabs_key");
      const bx = document.getElementById("voice-key-box");
      bx.innerHTML = k
        ? `<p class="glow">‚úÖ Key saved. <button class="generate-btn" onclick="clearVoiceKey()">Change</button></p>`
        : `<input id="voice-key" type="password" placeholder="üîë ElevenLabs Key"/><button class="generate-btn" onclick="saveVoiceKey()">Save</button>`;
    }
    function saveScriptKey() {
      const v = document.getElementById("script-key").value.trim();
      if (v.length>10) { localStorage.setItem("openrouter_key",v); loadScriptKey(); }
    }
    function saveVoiceKey() {
      const v = document.getElementById("voice-key").value.trim();
      if (v.length>10) { localStorage.setItem("elevenlabs_key",v); loadVoiceKey(); }
    }
    function clearScriptKey() { localStorage.removeItem("openrouter_key"); loadScriptKey(); }
    function clearVoiceKey() { localStorage.removeItem("elevenlabs_key"); loadVoiceKey(); }
    function clearAllKeys() { localStorage.clear(); alert("All keys cleared"); location.reload(); }
    function testKeys() {
      const o = !!localStorage.getItem("openrouter_key");
      const e = !!localStorage.getItem("elevenlabs_key");
      document.getElementById("settings-output").innerText = `OpenRouter: ${o?'‚úÖ':'‚ùå'}\nElevenLabs: ${e?'‚úÖ':'‚ùå'}`;
    }

    // ‚Äî Module functions
    async function generateScript() {
      const k = localStorage.getItem("openrouter_key"), inp = document.getElementById("script-input").value;
      const out = document.getElementById("script-output");
      if (!k||!inp) return out.innerText="‚ùå Missing input or key";
      out.innerText="‚è≥ Generating...";
      const r = await fetch("https://openrouter.ai/api/v1/chat/completions",{
        method:"POST",headers:{"Authorization":"Bearer "+k,"Content-Type":"application/json"},
        body:JSON.stringify({model:"openai/gpt-3.5-turbo",messages:[{role:"user",content:inp}]})
      });
      const d=await r.json();
      out.innerText = d?.choices?.[0]?.message?.content||"‚ö†Ô∏è No response";
      logHistory('Script', inp, out.innerText);
    }
    async function generateVoice() {
      const k=localStorage.getItem("elevenlabs_key"), txt=document.getElementById("voice-text").value,
            player=document.getElementById("voice-player");
      if (!k||!txt) return alert("‚ùå Missing input or key");
      const r=await fetch("https://api.elevenlabs.io/v1/text-to-speech/EXAVITQu4vr4xnSDxMaL/audio",{
        method:"POST", headers:{"xi-api-key":k,"Content-Type":"application/json"},
        body:JSON.stringify({text:txt,voice_settings:{stability:0.5,similarity_boost:0.5}})
      });
      const blob=await r.blob();
      player.src=URL.createObjectURL(blob);
      logHistory('Voice', txt, '[Audio generated]');
    }
    async function generateUploadStrategy() {
      const k=localStorage.getItem("openrouter_key"), inp=document.getElementById("upload-input").value;
      const out=document.getElementById("upload-output");
      if(!k||!inp) return out.innerText="‚ùå Missing input or key";
      out.innerText="‚è≥ Generating...";
      const r=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Authorization":"Bearer "+k,"Content-Type":"application/json"},
        body:JSON.stringify({model:"openai/gpt-3.5-turbo",messages:[{role:"system",content:"You are Upload Strategy AI. Provide platform/time/title hashtags."},{role:"user",content:inp}]})
      });
      const d=await r.json(); out.innerText=d?.choices?.[0]?.message?.content||"‚ö†Ô∏è No response";
      logHistory('UploadStrategy', inp, out.innerText);
    }
    async function generateTrends() {
      const k=localStorage.getItem("openrouter_key"), inp=document.getElementById("trends-input").value;
      const out=document.getElementById("trends-output");
      if(!k||!inp) return out.innerText="‚ùå Missing input or key";
      out.innerText="‚è≥ Generating...";
      const r=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Authorization":"Bearer "+k,"Content-Type":"application/json"},
        body:JSON.stringify({model:"openai/gpt-3.5-turbo",messages:[{role:"user",content:"What are trending video topics for: "+inp}]})
      });
      const d=await r.json(); out.innerText=d?.choices?.[0]?.message?.content||"‚ö†Ô∏è No response";
      logHistory('Trends', inp, out.innerText);
    }
    async function generateLegalReview() {
      const k=localStorage.getItem("openrouter_key"), inp=document.getElementById("legal-input").value;
      const out=document.getElementById("legal-output");
      if(!k||!inp) return out.innerText="‚ùå Missing input or key";
      out.innerText="üîç Reviewing...";
      const r=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Authorization":"Bearer "+k,"Content-Type":"application/json"},
        body:JSON.stringify({model:"openai/gpt-3.5-turbo",messages:[{role:"user",content:"Review for legal issues: "+inp}]})
      });
      const d=await r.json(); out.innerText=d?.choices?.[0]?.message?.content||"‚ö†Ô∏è No response";
      logHistory('Legal', inp, out.innerText);
    }

    // ‚Äî Automation UI
    function initAutomation() {
      canvas=document.getElementById("automation-canvas");
      canvas.innerHTML='<svg class="connector"></svg>';
      nodes=[]; nodeCount=0;
    }
    function addNode(label) {
      if(!canvas)return;
      const n=document.createElement("div");
      n.className="node"; n.textContent=label;
      n.dataset.id=++nodeCount; n.dataset.label=label;
      n.style.left=`${40+nodeCount*60}px`; n.style.top=`${40+nodeCount*30}px`;
      makeDraggable(n); canvas.appendChild(n); nodes.push(n);
    }
    function clearNodes() {
      initAutomation();
    }
    function drawLinkBetweenNodes(f,t) {
      const fm=nodes.find(n=>n.dataset.label===f), to=nodes.find(n=>n.dataset.label===t);
      if(!fm||!to)return;
      const svg=canvas.querySelector("svg"), r1=fm.getBoundingClientRect(), r2=to.getBoundingClientRect(),
            cr=canvas.getBoundingClientRect(),
            x1=r1.left+r1.width/2-cr.left, y1=r1.top+r1.height/2-cr.top,
            x2=r2.left+r2.width/2-cr.left, y2=r2.top+r2.height/2-cr.top;
      const line=document.createElementNS("http://www.w3.org/2000/svg","line");
      line.setAttribute("x1",x1); line.setAttribute("y1",y1);
      line.setAttribute("x2",x2); line.setAttribute("y2",y2);
      line.setAttribute("stroke","#00bfff"); line.setAttribute("stroke-width","2");
      svg.appendChild(line);
    }
    function makeDraggable(el) {
      let offX=0, offY=0;
      el.onmousedown = function(e) {
        offX=e.clientX-el.offsetLeft; offY=e.clientY-el.offsetTop;
        document.onmousemove = e2 => { el.style.left=e2.clientX-offX+"px"; el.style.top=e2.clientY-offY+"px"; };
        document.onmouseup = ()=>{ document.onmousemove=null; document.onmouseup=null; };
      };
    }

    // ‚Äî History logging
    function logHistory(module, input, output) {
      const ts = new Date().toLocaleTimeString();
      historyLog.push({ts, module, input, output});
      const el = document.getElementById("history-log");
      if(el) {
        el.innerText = historyLog.map(h=>`[${h.ts}] ${h.module} ‚Üí input: ${h.input} | output: ${h.output.substring(0,60)}...`).join("\n");
      }
    }

    // ‚Äî Manager controller
    async function runManagerCommand() {
      const cmd = document.getElementById("manager-command").value.trim();
      const out = document.getElementById("manager-response");
      const key = localStorage.getItem("openrouter_key");
      if(!cmd || !key) return out.innerText="‚ùå Missing command or OpenRouter key";
      out.innerText="ü§ñ Thinking...";
      const resp = await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Authorization":"Bearer "+key,"Content-Type":"application/json"},
        body:JSON.stringify({model:"openai/gpt-3.5-turbo",messages:[
          {role:"system",content:"You are Manager AI. Interpret commands to control other modules."},
          {role:"user",content:cmd}
        ]})
      });
      const data=await resp.json();
      const reply=data?.choices?.[0]?.message?.content||"‚ö†Ô∏è No response.";
      out.innerText=reply;
      logHistory('Manager', cmd, reply);
      interpretManager(cmd);
    }
    function interpretManager(cmd) {
      const lc = cmd.toLowerCase();
      if(lc.includes("script")) {
        selectModule('script');
        document.getElementById("script-input").value = extractAfter(cmd,"script on",cmd);
        generateScript();
      }
      if(lc.includes("voiceover")) {
        selectModule('voiceover');
        document.getElementById("voice-text").value = extractAfter(cmd,"voiceover for",cmd) || document.getElementById("script-output").innerText;
        generateVoice();
      }
      if(lc.includes("upload strategy")) {
        selectModule('upload');
        document.getElementById("upload-input").value = extractAfter(cmd,"upload strategy for",cmd)||document.getElementById("script-output").innerText;
        generateUploadStrategy();
      }
      if(lc.includes("trends")) {
        selectModule('trends');
        document.getElementById("trends-input").value = extractAfter(cmd,"trends in",cmd)||"";
        generateTrends();
      }
      if(lc.includes("legal")) {
        selectModule('legal');
        document.getElementById("legal-input").value = extractAfter(cmd,"legal review for",cmd)||document.getElementById("script-output").innerText;
        generateLegalReview();
      }
      selectModule('output');
    }
    function extractAfter(full, keyphrase, fallback) {
      const idx=full.toLowerCase().indexOf(keyphrase);
      return idx>=0?full.substring(idx+keyphrase.length).trim():fallback;
    }

    function selectModule(mod){
      document.querySelector(`[data-module="${mod}"]`).click();
    }

    window.onload = () => {
      selectModule('manager');
    };
  </script>
</body>
</html>
