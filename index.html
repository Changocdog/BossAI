<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Boss AI Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet"/>
  <style>
    /* ======== CORE LAYOUT & THEME ===================================================== */
    * { box-sizing: border-box; }
    body{
      margin:0;
      font-family:'Orbitron',sans-serif;
      background:linear-gradient(to right,#000000,#0a0a2a);
      color:#00bfff;
      display:flex;
      height:100vh;
      overflow:hidden;
    }
    .glow{ text-shadow:0 0 5px #00bfff,0 0 10px #00bfff;}
    /* ======== SIDEBAR ================================================================ */
    .sidebar{
      width:240px;background:#0d0d0d;padding:60px 10px 20px;
      display:flex;flex-direction:column;gap:10px;height:100vh;
      position:fixed;left:0;top:0;border-right:2px solid #1a1a1a;
      z-index:100;transition:transform .3s ease;
    }
    .sidebar.hidden{ transform:translateX(-100%);}
    .sidebar button{
      background:#121212;color:#00bfff;border:none;padding:12px;font-size:14px;
      text-align:left;border-radius:6px;cursor:pointer;
    }
    .sidebar button.active{ background:#007bff;color:#fff;}
    /* ======== MAIN AREA ============================================================== */
    .main{
      flex-grow:1;margin-left:240px;width:calc(100% - 240px);
      display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-start;
      padding:20px;overflow-y:auto;
    }
    .main.full{ margin-left:0;width:100%;}
    #toggle-btn{
      position:fixed;top:10px;left:10px;z-index:1000;
      background:#007bff;color:#fff;border:none;border-radius:6px;font-size:16px;
      padding:10px 16px;cursor:pointer;
    }
    /* ======== FORM ELEMENTS ========================================================== */
    textarea,input{
      width:100%;max-width:500px;padding:12px;margin-top:10px;font-size:15px;
      border-radius:6px;border:1px solid #00bfff;background:#1a1a1a;color:#fff;
    }
    button.generate-btn{
      background:#007bff;color:#fff;border:none;margin-top:10px;
      padding:10px 16px;border-radius:6px;font-size:15px;cursor:pointer;
    }
    .glow-box{
      max-width:800px;max-height:300px;overflow-y:auto;
      padding:10px;background:#121212;border:1px solid #00bfff;
      margin-top:10px;white-space:pre-wrap;
    }
    /* ======== AUTOMATION CANVAS ====================================================== */
    #automation-canvas{
      position:relative;border:2px solid #00bfff;background:#1a1a1a;
      width:100%;height:500px;margin-top:20px;overflow:hidden;
    }
    .node{
      position:absolute;background:#121212;border:1px solid #00bfff;
      padding:6px 10px;color:#00bfff;border-radius:6px;cursor:move;user-select:none;
    }
    svg.connector{ position:absolute;top:0;left:0;pointer-events:none;width:100%;height:100%;}
  </style>
</head>
<body>
  <!-- ======== SIDEBAR ======== -->
  <button id="toggle-btn">‚ò∞ Menu</button>
  <div class="sidebar" id="sidebar">
    <button data-module="manager" class="active">ü§ñ Manager AI</button>
    <button data-module="script">‚úçÔ∏è Script Writer</button>
    <button data-module="voiceover">üé§ Voiceover</button>
    <button data-module="automation">‚öôÔ∏è Automation AI</button>
    <button data-module="upload">üì§ Upload Strategy</button>
    <button data-module="trends">üìà Trends</button>
    <button data-module="legal">üìë Legal Review</button>
    <button data-module="output">üì¶ Final Output</button>
    <button data-module="history">üóÇÔ∏è History</button>
    <button data-module="settings">‚öôÔ∏è Settings</button>
  </div>

  <!-- ======== MAIN PANEL ======== -->
  <div class="main" id="main">
    <h1 class="glow">Boss AI Dashboard</h1>
    <p class="glow">Welcome. Select a module or command Manager AI.</p>
  </div>

  <!-- ======== SCRIPT & LOGIC ======== -->
  <script>
    /* ----------------------------------------------------------------------- *
     *  GLOBAL HANDLES + DYNAMIC MODULE TEMPLATES                              *
     * ----------------------------------------------------------------------- */
    const toggleBtn  = document.getElementById('toggle-btn');
    const sidebarEl  = document.getElementById('sidebar');
    const mainEl     = document.getElementById('main');
    const HISTORY_KEY = 'boss_ai_history';
    const MEMORY_KEY  = 'manager_memory';

    const content = {
      manager: `
        <h2 class="glow">ü§ñ Manager AI</h2>
        <textarea id="manager-command" placeholder="e.g., Connect Script Writer to Voiceover"></textarea><br>
        <button class="generate-btn" onclick="runManagerCommand()">Send</button>
        <div id="manager-response" class="glow-box"></div>
      `,
      script: `
        <h2 class="glow">‚úçÔ∏è Script Writer</h2>
        <textarea id="script-input" placeholder="Your video topic..."></textarea><br>
        <div id="script-key-box"></div>
        <button class="generate-btn" onclick="generateScript()">Generate Script</button>
        <p id="script-output" class="glow-box"></p>
      `,
      voiceover: `
        <h2 class="glow">üé§ Voiceover</h2>
        <textarea id="voice-text" placeholder="Enter your script here..."></textarea><br>
        <div id="voice-key-box"></div>
        <button class="generate-btn" onclick="generateVoice()">Generate Voice</button>
        <audio id="voice-player" controls style="margin-top:10px;"></audio>
      `,
      automation: `
        <h2 class="glow">‚öôÔ∏è Automation AI</h2>
        <button class="generate-btn" onclick="addNode('Script Writer')">+ Script Node</button>
        <button class="generate-btn" onclick="addNode('Voiceover')">+ Voice Node</button>
        <button class="generate-btn" onclick="clearNodes()">Reset</button>
        <div id="automation-canvas"><svg class="connector"></svg></div>
      `,
      upload: `
        <h2 class="glow">üì§ Upload Strategy</h2>
        <textarea id="upload-input" placeholder="Describe your video..."></textarea><br>
        <button class="generate-btn" onclick="generateUploadStrategy()">Generate Strategy</button>
        <div id="upload-output" class="glow-box"></div>
      `,
      trends: `
        <h2 class="glow">üìà Trends & Topic AI</h2>
        <textarea id="trends-input" placeholder="What's your niche/topic area?"></textarea><br>
        <button class="generate-btn" onclick="generateTrends()">Get Trends</button>
        <div id="trends-output" class="glow-box"></div>
      `,
      legal: `
        <h2 class="glow">üìë Legal Review</h2>
        <textarea id="legal-input" placeholder="Paste your script or plan..."></textarea><br>
        <button class="generate-btn" onclick="generateLegalReview()">Review</button>
        <div id="legal-output" class="glow-box"></div>
      `,
      output: `
        <h2 class="glow">üì¶ Final Output</h2>
        <div class="glow-box" id="final-output-box">Your final script and voiceover will appear here.</div>
      `,
      history: `
        <h2 class="glow">üóÇÔ∏è History Log</h2>
        <div class="glow-box" id="history-log">Loading history...</div>
        <button class="generate-btn" onclick="exportHistory()">Export ‚¨áÔ∏è</button>
        <button class="generate-btn" onclick="clearHistory()">Clear History</button>
      `,
      settings: `
        <h2 class="glow">‚öôÔ∏è Settings</h2>
        <button class="generate-btn" onclick="clearAllKeys()">Clear All Saved Keys</button><br>
        <button class="generate-btn" onclick="testKeys()">Test Saved Keys</button>
        <div id="settings-output" class="glow-box"></div>
      `
    };

    /* ----------------------------------------------------------------------- *
     *  SIDEBAR NAVIGATION                                                     *
     * ----------------------------------------------------------------------- */
    sidebarEl.querySelectorAll('button').forEach(btn=>{
      btn.addEventListener('click',()=>{
        sidebarEl.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const mod = btn.dataset.module;
        mainEl.innerHTML = `<div style="max-width:800px;width:100%;">${content[mod]}</div>`;
        // After mount ‚Äì setup module-specific UI:
        if(mod==='script')   initScriptModule();
        if(mod==='voiceover')initVoiceModule();
        if(mod==='automation')initAutomation();
        if(mod==='history')  loadHistory();
      });
    });

    toggleBtn.addEventListener('click',()=>{
      sidebarEl.classList.toggle('hidden');
      mainEl.classList.toggle('full');
    });

    /* ----------------------------------------------------------------------- *
     *  UTILITY: TIME STAMP                                                    *
     * ----------------------------------------------------------------------- */
    const now = ()=> new Date().toLocaleString();

    /* ----------------------------------------------------------------------- *
     *  HISTORY UTILITIES                                                      *
     * ----------------------------------------------------------------------- */
    function addHistory(type,text){
      const entry = { time:now(), type, text };
      const list = JSON.parse(localStorage.getItem(HISTORY_KEY)||'[]');
      list.push(entry);
      localStorage.setItem(HISTORY_KEY,JSON.stringify(list));
    }
    function loadHistory(){
      const box = document.getElementById('history-log');
      const list = JSON.parse(localStorage.getItem(HISTORY_KEY)||'[]');
      box.textContent = list.length? list.map(e=>`[${e.time}] ${e.type}: ${e.text}`).join('\n') : 'No history yet.';
    }
    function clearHistory(){
      localStorage.removeItem(HISTORY_KEY);
      loadHistory();
    }
    function exportHistory(){
      const data = localStorage.getItem(HISTORY_KEY)||'[]';
      const blob = new Blob([data],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href=url;a.download='boss_ai_history.json';a.click();
      URL.revokeObjectURL(url);
    }

    /* ----------------------------------------------------------------------- *
     *  MODULE INITIALISERS                                                    *
     * ----------------------------------------------------------------------- */
    function initScriptModule(){ loadScriptKey(); }
    function initVoiceModule(){  loadVoiceKey();  }

    /* ----------------------------------------------------------------------- *
     *  KEY MANAGEMENT                                                         *
     * ----------------------------------------------------------------------- */
    function loadScriptKey(){
      const key = localStorage.getItem('openrouter_key')||'';
      const box = document.getElementById('script-key-box');
      if(!box) return;
      box.innerHTML = key
       ?`<p class="glow">‚úÖ Key saved. <button class="generate-btn" onclick="clearScriptKey()">Change</button></p>`
       :`<input id="script-key" placeholder="üîë OpenRouter Key"/><button class="generate-btn" onclick="saveScriptKey()">Save</button>`;
    }
    function saveScriptKey(){
      const val = document.getElementById('script-key').value.trim();
      if(val.length>10){ localStorage.setItem('openrouter_key',val); loadScriptKey(); }
    }
    function clearScriptKey(){ localStorage.removeItem('openrouter_key'); loadScriptKey();}
    function loadVoiceKey(){
      const key = localStorage.getItem('elevenlabs_key')||'';
      const box = document.getElementById('voice-key-box');
      if(!box) return;
      box.innerHTML = key
       ?`<p class="glow">‚úÖ Key saved. <button class="generate-btn" onclick="clearVoiceKey()">Change</button></p>`
       :`<input id="voice-key" placeholder="üîë ElevenLabs Key"/><button class="generate-btn" onclick="saveVoiceKey()">Save</button>`;
    }
    function saveVoiceKey(){
      const val = document.getElementById('voice-key').value.trim();
      if(val.length>10){ localStorage.setItem('elevenlabs_key',val); loadVoiceKey(); }
    }
    function clearVoiceKey(){ localStorage.removeItem('elevenlabs_key'); loadVoiceKey();}
    function clearAllKeys(){
      localStorage.removeItem('openrouter_key');
      localStorage.removeItem('elevenlabs_key');
      localStorage.removeItem(MEMORY_KEY);
      alert('All keys & manager memory cleared.');
    }
    function testKeys(){
      const open = localStorage.getItem('openrouter_key')?'‚úÖ':'‚ùå';
      const ele  = localStorage.getItem('elevenlabs_key')?'‚úÖ':'‚ùå';
      document.getElementById('settings-output').textContent = `OpenRouter: ${open}\nElevenLabs: ${ele}`;
    }

    /* ----------------------------------------------------------------------- *
     *  MANAGER AI WITH MEMORY                                                 *
     * ----------------------------------------------------------------------- */
    let managerMemory = JSON.parse(localStorage.getItem(MEMORY_KEY)||'[]');
    async function runManagerCommand(){
      const cmd = document.getElementById('manager-command').value.trim();
      const box = document.getElementById('manager-response');
      const key = localStorage.getItem('openrouter_key');
      if(!cmd){ box.textContent='Enter a command.'; return; }
      if(!key){ box.textContent='OpenRouter key required.'; return; }
      box.textContent='ü§ñ Thinking...';
      managerMemory.push({ role:'user',content:cmd });
      const res = await fetch('https://openrouter.ai/api/v1/chat/completions',{
        method:'POST',
        headers:{'Authorization':'Bearer '+key,'Content-Type':'application/json'},
        body:JSON.stringify({ model:'openai/gpt-3.5-turbo', messages:managerMemory.slice(-10) })
      }).then(r=>r.json()).catch(()=>'');
      const reply = res?.choices?.[0]?.message?.content || 'No response.';
      managerMemory.push({ role:'assistant',content:reply });
      localStorage.setItem(MEMORY_KEY,JSON.stringify(managerMemory.slice(-20)));
      box.textContent = reply;
      addHistory('Manager AI',cmd+' => '+reply);
      const match = cmd.match(/connect (.+?) to (.+)/i);
      if(match){ addNode(match[1].trim()); addNode(match[2].trim()); drawLinkBetweenNodes(match[1].trim(),match[2].trim()); }
    }

    /* ----------------------------------------------------------------------- *
     *  SCRIPT WRITER                                                          *
     * ----------------------------------------------------------------------- */
    async function generateScript(){
      const topic = document.getElementById('script-input').value.trim();
      const out   = document.getElementById('script-output');
      const key   = localStorage.getItem('openrouter_key');
      if(!topic){ out.textContent='Topic required.'; return;}
      if(!key){   out.textContent='OpenRouter key missing.'; return;}
      out.textContent='‚úçÔ∏è Writing...';
      const res = await fetch('https://openrouter.ai/api/v1/chat/completions',{
        method:'POST',
        headers:{'Authorization':'Bearer '+key,'Content-Type':'application/json'},
        body:JSON.stringify({ model:'openai/gpt-3.5-turbo', messages:[{role:'user',content:`Write a viral 60-second script about ${topic}.`}] })
      }).then(r=>r.json()).catch(()=>'');
      const script = res?.choices?.[0]?.message?.content || 'No script.';
      out.textContent = script;
      document.getElementById('final-output-box').textContent += '\n\n--- Script ---\n'+script;
      addHistory('Script',topic);
    }

    /* ----------------------------------------------------------------------- *
     *  VOICE-OVER                                                             *
     * ----------------------------------------------------------------------- */
    async function generateVoice(){
      const text = document.getElementById('voice-text').value.trim();
      const key  = localStorage.getItem('elevenlabs_key');
      const player = document.getElementById('voice-player');
      if(!text){ alert('Text required.'); return;}
      if(!key){  alert('ElevenLabs key missing.'); return;}
      player.src='';player.load();
      const blob = await fetch('https://api.elevenlabs.io/v1/text-to-speech/EXAVITQu4vr4xnSDxMaL/stream',{
        method:'POST',
        headers:{'xi-api-key':key,'Content-Type':'application/json'},
        body:JSON.stringify({ text, model_id:'eleven_monolingual_v1',voice_settings:{stability:0.35,similarity_boost:0.85} })
      }).then(r=>r.blob()).catch(()=>null);
      if(!blob){ alert('Voice generation failed.'); return;}
      player.src=URL.createObjectURL(blob);
      player.play();
      addHistory('Voice','Voice generated.');
      document.getElementById('final-output-box').textContent += '\n\n--- Voice generated (audio) ---';
    }

    /* ----------------------------------------------------------------------- *
     *  UPLOAD STRATEGY / TRENDS / LEGAL REVIEW                                *
     * ----------------------------------------------------------------------- */
    function generateUploadStrategy(){
      const idea = document.getElementById('upload-input').value.trim();
      const out  = document.getElementById('upload-output');
      if(!idea){ out.textContent='Provide an idea.'; return;}
      out.textContent = `üì§ Best platform: TikTok\n‚è∞ Post time: 7 PM local\nüîë Title: "${idea} in 60 seconds"\n#Ô∏è‚É£ Hashtags: #${idea.replace(/\s+/g,'')} #fyp`;
      addHistory('Upload',idea);
    }
    function generateTrends(){
      const niche = document.getElementById('trends-input').value.trim();
      const out   = document.getElementById('trends-output');
      if(!niche){ out.textContent='Enter a niche.'; return;}
      out.textContent=`üî• Top trends in ${niche} today:\n‚Ä¢ AI hacks\n‚Ä¢ 30-day challenges\n‚Ä¢ Retro tech\n‚Ä¢ Minimal living`;
      addHistory('Trends',niche);
    }
    function generateLegalReview(){
      const txt = document.getElementById('legal-input').value.trim();
      const out = document.getElementById('legal-output');
      if(!txt){ out.textContent='Paste text to review.'; return;}
      out.textContent=`‚úÖ No copyright or trademark issues detected.\n‚ö†Ô∏è Ensure all third-party clips are under 15 s and fair-use.`;
      addHistory('Legal','Reviewed');
    }

    /* ----------------------------------------------------------------------- *
     *  AUTOMATION CANVAS                                                      *
     * ----------------------------------------------------------------------- */
    let nodes=[],links=[],nodeCount=0,svgEl;
    function initAutomation(){
      const canvas=document.getElementById('automation-canvas');
      if(!canvas) return;
      svgEl = canvas.querySelector('svg');
      canvas.addEventListener('mousedown',dragStart);
    }
    function addNode(label){
      const canvas=document.getElementById('automation-canvas');
      if(!canvas) return;
      const n=document.createElement('div');
      n.className='node';n.textContent=label;n.dataset.id=++nodeCount;
      n.style.left=40+nodeCount*30+'px';n.style.top=40+nodeCount*20+'px';
      canvas.appendChild(n);nodes.push(n);
    }
    function drawLinkBetweenNodes(fromLabel,toLabel){
      const from=nodes.find(n=>n.textContent===fromLabel);
      const to  =nodes.find(n=>n.textContent===toLabel);
      if(!from||!to) return;
      links.push({from,to}); renderLinks();
    }
    function renderLinks(){
      if(!svgEl) return; svgEl.innerHTML='';
      links.forEach(l=>{
        const x1=l.from.offsetLeft+l.from.offsetWidth/2;
        const y1=l.from.offsetTop +l.from.offsetHeight/2;
        const x2=l.to.offsetLeft  +l.to.offsetWidth/2;
        const y2=l.to.offsetTop   +l.to.offsetHeight/2;
        const line=document.createElementNS('http://www.w3.org/2000/svg','line');
        line.setAttribute('x1',x1);line.setAttribute('y1',y1);
        line.setAttribute('x2',x2);line.setAttribute('y2',y2);
        line.setAttribute('stroke','#00bfff');line.setAttribute('stroke-width','2');
        svgEl.appendChild(line);
      });
    }
    function dragStart(e){
      const target=e.target;
      if(!target.classList.contains('node')) return;
      const shiftX=e.clientX-target.offsetLeft;
      const shiftY=e.clientY-target.offsetTop;
      function move(ev){
        target.style.left=ev.clientX-shiftX+'px';
        target.style.top =ev.clientY-shiftY+'px';
        renderLinks();
      }
      document.addEventListener('mousemove',move);
      document.addEventListener('mouseup',()=>document.removeEventListener('mousemove',move),{once:true});
    }
    function clearNodes(){
      nodes.forEach(n=>n.remove());nodes=[];links=[];renderLinks();
    }

    /* ----------------------------------------------------------------------- *
     *  PAGE LOAD DEFAULTS                                                     *
     * ----------------------------------------------------------------------- */
    window.onload=()=>{ sidebarEl.querySelector('[data-module="manager"]').click(); };
  </script>
</body>
</html>
