<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BossAI - Workflow Automation</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.9/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-flow-renderer@10.3.17/dist/ReactFlow.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    #app { height: 100vh; display: flex; }
    .react-flow__node { cursor: grab; }
    .react-flow__node:hover { cursor: grabbing; }
    .sidebar { width: 300px; background: #f9fafb; border-left: 1px solid #e5e7eb; overflow-y: auto; }
    .node-panel { background: #f3f4f6; padding: 1rem; border-bottom: 1px solid #e5e7eb; }
  </style>
</head>
<body>
  <div id="app"></div>
  <script type="text/babel">
    const { useState, useCallback } = React;
    const ReactFlow = window.ReactFlow.default;

    // Initial nodes and edges
    const initialNodes = [
      { id: '1', type: 'input', data: { label: 'Trigger', config: { type: 'manual' } }, position: { x: 250, y: 25 } },
      { id: '2', data: { label: 'HTTP Request', config: { url: '' } }, position: { x: 250, y: 150 } },
    ];
    const initialEdges = [{ id: 'e1-2', source: '1', target: '2', animated: true }];

    const nodeTypes = {
      input: ({ data }) => (
        <div className="bg-blue-500 text-white px-4 py-2 rounded shadow">
          <strong>{data.label}</strong>
        </div>
      ),
      default: ({ data }) => (
        <div className="bg-white border border-gray-300 px-4 py-2 rounded shadow">
          <strong>{data.label}</strong>
        </div>
      ),
    };

    const App = () => {
      const [nodes, setNodes] = useState(initialNodes);
      const [edges, setEdges] = useState(initialEdges);
      const [selectedNode, setSelectedNode] = useState(null);

      // Handle node drag and drop
      const onNodesChange = useCallback((changes) => {
        setNodes((nds) => window.ReactFlow.applyNodeChanges(changes, nds));
      }, []);

      // Handle edge creation
      const onConnect = useCallback((params) => {
        setEdges((eds) => window.ReactFlow.addEdge({ ...params, animated: true }, eds));
      }, []);

      // Add new node
      const addNode = (type, label) => {
        const newNode = {
          id: `${nodes.length + 1}`,
          type: type === 'trigger' ? 'input' : 'default',
          data: { label, config: type === 'trigger' ? { type: 'manual' } : { url: '' } },
          position: { x: Math.random() * 400, y: Math.random() * 400 },
        };
        setNodes((nds) => [...nds, newNode]);
      };

      // Handle node selection
      const onNodeClick = (event, node) => {
        setSelectedNode(node);
      };

      // Update node config
      const updateNodeConfig = (id, config) => {
        setNodes((nds) =>
          nds.map((node) =>
            node.id === id ? { ...node, data: { ...node.data, config } } : node
          )
        );
      };

      // Simulate workflow execution
      const runWorkflow = () => {
        console.log('Running workflow...');
        nodes.forEach((node) => {
          console.log(`Executing ${node.data.label}:`, node.data.config);
        });
      };

      return (
        <div className="flex h-full">
          {/* Node Panel */}
          <div className="node-panel w-64 bg-gray-100 p-4">
            <h2 className="text-lg font-bold mb-4">Nodes</h2>
            <button
              className="w-full bg-blue-500 text-white py-2 mb-2 rounded hover:bg-blue-600"
              onClick={() => addNode('trigger', 'Trigger')}
            >
              Add Trigger
            </button>
            <button
              className="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600"
              onClick={() => addNode('action', 'HTTP Request')}
            >
              Add HTTP Request
            </button>
            <button
              className="w-full bg-green-500 text-white py-2 mt-4 rounded hover:bg-green-600"
              onClick={runWorkflow}
            >
              Run Workflow
            </button>
          </div>

          {/* Workflow Canvas */}
          <div className="flex-1">
            <ReactFlow
              nodes={nodes}
              edges={edges}
              onNodesChange={onNodesChange}
              onConnect={onConnect}
              onNodeClick={onNodeClick}
              nodeTypes={nodeTypes}
              fitView
            >
              <ReactFlow.Controls />
              <ReactFlow.Background />
            </ReactFlow>
          </div>

          {/* Sidebar for Node Configuration */}
          {selectedNode && (
            <div className="sidebar p-4">
              <h2 className="text-lg font-bold mb-4">Configure {selectedNode.data.label}</h2>
              {selectedNode.type === 'input' ? (
                <div>
                  <label className="block mb-2">Trigger Type</label>
                  <select
                    className="w-full p-2 border rounded"
                    value={selectedNode.data.config.type}
                    onChange={(e) =>
                      updateNodeConfig(selectedNode.id, { type: e.target.value })
                    }
                  >
                    <option value="manual">Manual</option>
                    <option value="schedule">Schedule</option>
                  </select>
                </div>
              ) : (
                <div>
                  <label className="block mb-2">URL</label>
                  <input
                    type="text"
                    className="w-full p-2 border rounded"
                    value={selectedNode.data.config.url}
                    onChange={(e) =>
                      updateNodeConfig(selectedNode.id, { url: e.target.value })
                    }
                    placeholder="Enter URL"
                  />
                </div>
              )}
              <button
                className="mt-4 bg-gray-500 text-white py-2 px-4 rounded hover:bg-gray-600"
                onClick={() => setSelectedNode(null)}
              >
                Close
              </button>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('app'));
  </script>
</body>
</html>
